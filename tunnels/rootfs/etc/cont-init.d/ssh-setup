#!/usr/bin/with-contenv bashio

if [[ ! -d /share/ssh-tunnels/id_rsa || ! -d /share/ssh-tunnels/id_rsa.pub || $(bashio::config 'force_new_sshkey') ]]; then
  mkdir -p /share/ssh-tunnels
  ssh-keygen -q -t rsa -N '' -f /share/ssh-tunnels/id_rsa <<<y >/dev/null 2>&1
fi

bashio::log.info "Display id_rsa.pub:"
cat /share/ssh-tunnels/id_rsa.pub

bashio::log.info "Display SSH key hash:"
ssh-keygen -lf /share/ssh-tunnels/id_rsa | awk '{print $2}'